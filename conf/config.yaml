# @package _global_

# Main configuration file for DCASE Few-Shot Bioacoustic
# This follows the baseline v1 structure

defaults:
  - _self_
  - arch: v1
  - callbacks: default.yaml
  - logger: mlflow.yaml
  - trainer: default.yaml
  - log_dir: default.yaml
  - experiment: null
  - debug: null
  - optional local: default.yaml

# General Settings
print_config: true
ignore_warnings: true
train: true
test: true
seed: 1234
disable_cudnn: false
name: "mlflow_experiments"
# exp_name is provided via CLI --exp-name flag (required)

# Path Configuration
path:
  root_dir: /data/msc-proj
  train_dir: ${path.root_dir}/Training_Set
  eval_dir: ${path.root_dir}/Validation_Set_DSAI_2025_2026
  test_dir: ${path.root_dir}/Evaluation_Set_DSAI_2025_2026
  extra_train_dir: null
  mask_dir: null

# Feature Extraction Configuration
features:
  eps: 2e-16
  fmax: 11025
  fmin: 50
  sr: 22050
  n_fft: 1024
  n_mels: 128
  hop_mel: 256
  feature_types: pcen
  embedding_dim: 2048
  drop_rate: 0.1
  with_bias: false
  non_linearity: leaky_relu
  time_max_pool_dim: 4
  layer_4: false
  test_seglen_len_lim: 30
  test_hoplen_fenmu: 3
  cache_dir: ${path.root_dir}/features_cache
  version: v1
  use_cache: true
  force_recompute: false
  format: npy
  normalize: true
  normalize_mode: per_sample

# Training Parameters
train_param:
  exp_name: ${exp_name}
  sr: ${features.sr}
  seg_len: 0.2
  n_shot: 5
  k_way: 10
  device: cuda
  lr_rate: 0.001
  scheduler_gamma: 0.65
  scheduler_step_size: 10
  num_episodes: 2000
  adaptive_seg_len: true
  use_validation_first_5: false
  negative_train_contrast: true
  load_weight_from: null
  negative_seg_search: false
  merging_segment: false
  remove_long_segment: false
  padd_tail: false

# Evaluation Parameters
eval_param:
  seg_len: 0.200
  hop_seg: 0.05
  samples_neg: 150
  iterations: 3
  query_batch_size: 8
  negative_set_batch_size: 16
  threshold: 0.9
  negative_estimate: freq_mask

# Annotation Settings
annotations:
  train_files:
    - ${path.train_dir}/**/*.csv
  val_files:
    - ${path.eval_dir}/**/*.csv
  test_files:
    - ${path.test_dir}/**/*.csv
  positive_label: POS
  class_name: null
  min_duration: ${train_param.seg_len}
  max_frames: 512
  batch_size: 1

# Runtime Settings
runtime:
  device: auto
  num_workers: 4
  prefetch_factor: 2
  log_dir: outputs/${name}/${exp_name}
  ckpt_dir: ${runtime.log_dir}/checkpoints

# Execution Flags
set:
  features: false
  train: true
  eval: false
