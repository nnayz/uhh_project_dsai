# @package _global_

# Main configuration file for DCASE Few-Shot Bioacoustic
# This follows the baseline v1 structure

defaults:
  - _self_
  - arch: v1
  - callbacks: default.yaml
  - logger: mlflow.yaml
  - trainer: default.yaml
  - log_dir: default.yaml
  - experiment: null
  - debug: null
  - optional local: default.yaml

# General Settings
print_config: false
ignore_warnings: true
train: true
test: false # By default, we do not test the model on the evaluation dataset
seed: 1234
disable_cudnn: false
name: "mlflow_experiments"
# exp_name is provided via CLI --exp-name flag (required)

# Path Configuration
path:
  root_dir: /data/msc-proj
  train_dir: ${path.root_dir}/Training_Set
  eval_dir: ${path.root_dir}/Validation_Set_DSAI_2025_2026
  test_dir: ${path.root_dir}/Evaluation_Set_DSAI_2025_2026
  extra_train_dir: null
  mask_dir: null

# Feature Extraction Configuration
features:
  eps: 1e-8
  fmax: 11025
  fmin: 50
  sr: 22050
  n_fft: 1024
  n_mels: 128
  hop_mel: 256
  feature_types: logmel
  embedding_dim: 2048
  drop_rate: 0.1
  with_bias: false
  non_linearity: leaky_relu
  time_max_pool_dim: 4
  layer_4: false
  test_seglen_len_lim: 30
  test_hoplen_fenmu: 3

# Training Parameters
train_param:
  exp_name: ${exp_name}
  sr: ${features.sr}
  seg_len: 0.2
  n_shot: 5
  k_way: 10
  lr_rate: 0.001
  scheduler_gamma: 0.65
  scheduler_step_size: 10
  num_episodes: 2000
  adaptive_seg_len: true
  use_validation_first_5: false  # If true, include first n_shot positives from val as support in training
  negative_train_contrast: true
  load_weight_from: null

# Evaluation Parameters
eval_param:
  seg_len: 0.200
  hop_seg: 0.05
  samples_neg: 150
  iterations: 3
  query_batch_size: 8
  negative_estimate: freq_mask

# Runtime Settings
runtime:
  device: auto
  num_workers: 4
  prefetch_factor: 2
  log_dir: outputs/${name}/${exp_name}
  ckpt_dir: ${runtime.log_dir}/checkpoints

# Checkpoint Settings
checkpoint:
  monitor: "val/acc"  # Metric to monitor for best checkpoint (e.g., "val/acc", "val/loss", "val/fmeasure")
  mode: "max"         # "max" for metrics like accuracy, "min" for metrics like loss

# Execution Flags
set:
  features: false
  train: true
  eval: false
